/*
========================================================================================
   SLURM Configuration
========================================================================================
*/

process {
    executor = 'slurm'
    queue = 'normal'
    
    // SLURM directives
    clusterOptions = '--account=your_account'
    
    // Error handling for SLURM
    errorStrategy = { task.exitStatus in [143,137,104,134,139] ? 'retry' : 'finish' }
    maxRetries = 3
    
    // Resource labels
    withLabel: 'process_low' {
        cpus = { check_max(2, 'cpus') }
        memory = { check_max(6.GB * task.attempt, 'memory') }
        time = { check_max(4.h * task.attempt, 'time') }
        queue = 'short'
    }
    
    withLabel: 'process_medium' {
        cpus = { check_max(8, 'cpus') }
        memory = { check_max(32.GB * task.attempt, 'memory') }
        time = { check_max(12.h * task.attempt, 'time') }
        queue = 'normal'
    }
    
    withLabel: 'process_high' {
        cpus = { check_max(16, 'cpus') }
        memory = { check_max(64.GB * task.attempt, 'memory') }
        time = { check_max(48.h * task.attempt, 'time') }
        queue = 'long'
    }
}

singularity {
    enabled = true
    autoMounts = true
    cacheDir = "$HOME/.singularity_cache"
}

// Module system (if available)
// Uncomment and modify as needed for your HPC
/*
process {
    beforeScript = 'module load singularity'
}
*/
